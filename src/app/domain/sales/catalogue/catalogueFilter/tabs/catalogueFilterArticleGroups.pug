.block-to-collapse.article-groups(
class='panel-default'
uib-accordion-group
is-open='vm.tabsOpen.categories'
)

  uib-accordion-heading
    .title Группа
    .active-tags(ng-if='!vm.tabsOpen.categories && vm.cvm.currentArticleGroup')
      a(href ng-click='vm.activeArticleGroupClick($event)')
        | {{ vm.cvm.currentArticleGroup.displayName }}
    span.caret.turnable(ng-class='{"turn-90-counter-clock": vm.tabsOpen.categories}')

  .accordion-body

    ul.preceding-groups(ng-if='vm.cvm.showFirstLevel && vm.cvm.precedingGroups.length')

      .list-group-item(
      ng-repeat='elem in vm.cvm.precedingGroups | orderBy:"name" track by elem.id'
      )
        a.articleGroup(
        href
        stm-click='articleGroupAndCollapse' click-payload='elem'
        )
          .name {{::elem.displayName }}

        a.chevron(
        href
        stm-click='articleGroup' click-payload='elem'
        )
          i.glyphicon.glyphicon-menu-right

    ul.list-group.xs-ancestors(
    ng-if='vm.cvm.ancestors.length'
    )

      .list-group-item(
      ng-repeat='ancestor in vm.ancestorGroups() track by ancestor.id'
      )

        a.chevron(
        stm-click='articleGroup' click-payload='ancestor'
        )
          i.glyphicon.glyphicon-menu-left

        a.articleGroup(
        href
        stm-click='articleGroupAndCollapse' click-payload='ancestor'
        ) {{::ancestor.displayName}}

    ul.list-group.expanded

      a.list-group-item.active(
      href
      ng-if='!vm.cvm.noMoreChildren && vm.cvm.currentArticleGroup.displayName || !vm.cvm.currentArticleGroup && vm.cvm.showOnlyOrdered'
      ng-click='vm.cvm.articleGroupClick();'
      )
        span {{ vm.cvm.currentArticleGroup.displayName || 'Товары заказа' }}

      .list-group-item(
      ng-repeat='elem in vm.cvm.articleGroups | orderBy:"name" track by elem.id'
      ng-class='{active: vm.cvm.currentArticleGroup.id === elem.id}'
      )
        a.articleGroup(
        href
        stm-click='articleGroupAndCollapse' click-payload='elem'
        )
          .name {{::elem.displayName }}
          .badge(ng-if='::vm.cvm.articleGroupIds[elem.id]')
            span {{::vm.cvm.articleGroupIds[elem.id]}}
            span(ng-if='::elem.children.length') +

        a.chevron(
        href
        stm-click='articleGroup' click-payload='elem'
        ng-if='::elem.children.length && !vm.cvm.articleGroupIds[elem.id]'
        )
          i.glyphicon.glyphicon-menu-right

    ul.following-groups(ng-if='vm.cvm.showFirstLevel && vm.cvm.followingGroups.length')

      .list-group-item(
      ng-repeat='elem in vm.cvm.followingGroups | orderBy:"name" track by elem.id'
      )
        a.articleGroup(
        href
        stm-click='articleGroupAndCollapse' click-payload='elem'
        )
          .name {{::elem.displayName }}

        a.chevron(
        href
        stm-click='articleGroup' click-payload='elem'
        )
          i.glyphicon.glyphicon-menu-right
