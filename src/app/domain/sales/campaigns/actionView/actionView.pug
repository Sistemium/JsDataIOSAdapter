.action-view

  table(border="1")
    thead
      th.ranges(colspan="2") {{ vm.action.name }}
      th.required.volume Объём
      th.required.sku SKU
      th.discount.total % общая
      th.discount.comp % комп.
      th.discount.own % комм.
    tbody.variant(ng-repeat="variant in vm.variants track by variant.num")

      tr(ng-if="variant.title")
        td.idx(rowspan="{{ variant.rowspan + 1 }}") {{ variant.num }}
        td.ranges(colspan="6")
          .name {{ ::variant.title }}

      tr(ng-repeat="row in variant.rows track by $index")

        td.idx(rowspan="{{ variant.rowspan }}" ng-if="!variant.title && !$index") {{ variant.num }}

        td.ranges(
          ng-if="!variant.title && (variant.name || variant.ranges.length) && !$index"
          rowspan="{{ variant.rowspan }}"
        )
          .name(ng-if="variant.name") {{ variant.name }}
          .range(ng-repeat="range in variant.ranges track by $index") • {{ range.name }}
          .comment(ng-if="variant.commentText") {{ variant.commentText }}

        td.ranges(ng-if="!variant.name && !variant.ranges.length || variant.title")
          .name(ng-if="row.name") {{ row.name }}
          .range(ng-repeat="range in row.ranges track by $index") • {{ range.name }}
          .comment(ng-if="row.commentText") {{ row.commentText }}

        td.required.volume(ng-if="variant.requiredVolume && !$index" rowspan="{{ variant.rows.length }}")
          action-required-volume(required="variant.requiredVolume")
        td.required.volume(ng-if="!variant.requiredVolume")
          action-required-volume(required="row.requiredVolume")

        td.required.sku(ng-if="variant.required.sku && !$index" rowspan="{{ variant.rows.length }}")
          span {{ variant.required.sku || '-' }}
        td.required.sku(ng-if="!variant.required.sku")
          span {{ row.required.sku || '-' }}

        td.discount.total(ng-if="variant.discountTotal && !$index" rowspan="{{ variant.rows.length }}")
          span {{ variant.discountTotal }}
        td.discount.total(ng-if="variant.hasDiscounts && !variant.discountTotal")
          span {{ row.discountTotal || '-' }}

        td.discount.comp(ng-if="variant.discountComp && !$index" rowspan="{{ variant.rows.length }}")
          span {{ variant.discountComp }}
        td.discount.comp(ng-if="variant.hasDiscounts && !variant.discountComp")
          span {{ row.discountComp || '-' }}

        td.discount.comp(ng-if="variant.discountOwn && !$index" rowspan="{{ variant.rows.length }}")
          span {{ variant.discountOwn }}
        td.discount.comp(ng-if="variant.hasDiscounts && !variant.discountOwn")
          span {{ row.discountOwn || '-' }}

        td.discount.bonus(ng-if="!variant.hasDiscounts" colspan="3")
          span(ng-if="row.discountCash") Бонус {{ row.discountCash }} ₽
          span(ng-if="row.discountOther") {{ row.discountOther }}

      tr(ng-if="variant.discountMatrix")
        td(colspan="7")
          action-matrix(discount-matrix="variant.discountMatrix")

      tr.variant-comment(ng-if="variant.commentText && !variant.name && !variant.ranges.length")
        td(colspan="6")
          .comment(ng-bind-html="variant.commentText")

    tfoot(ng-if="vm.showFooter")
      td(colspan="7")
        .need-photo(ng-if="vm.action.needPhoto")
          i.glyphicon.glyphicon-camera
          span Фото-отчет
        .priority(ng-if="vm.action.priority")
          i.glyphicon.glyphicon-flag
          span {{ vm.action.priority.name }}
        .other(ng-style="vm.layoutStyle" ng-class="vm.layout.align")
          action-pictures(action="vm.action" ng-if="vm.showPictures && vm.action.layout.pictures.length")
          .comment(ng-bind-html="vm.footerCommentText")
